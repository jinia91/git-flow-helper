name: Auto Sync Branch to Dev

on:
#  push:
#    branches:
#      - main

  pull_request:
    types: [opened, synchronize, edited]

jobs:
  auto-create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Setup Git Config
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      - name: Identify Merged Branch
        id: merged_branch
        run: |
          MERGED_BRANCH_NAME=$(git log -1 --pretty=%B | grep -oP 'Merge pull request #\d+ from \K[\w\-/]+')
          echo "Merged branch name: $MERGED_BRANCH_NAME"
          echo "::set-output name=branch::${MERGED_BRANCH_NAME}"

      - name: Create Pull Request to Dev
        if: steps.merged_branch.outputs.branch
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ steps.merged_branch.outputs.branch }}-to-dev
          base: dev
          title: "Sync ${ { steps.merged_branch.outputs.branch } } changes to Dev"
          body: "This automated pull request merges changes from ${ { steps.merged_branch.outputs.branch } } to Dev."
          labels: sync,auto-pr
